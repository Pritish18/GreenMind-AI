<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GreenMind AI</title>
  <link rel="stylesheet" href="static/style.css" />
</head>
<body>
  <div class="toggle-container">
    <label class="switch">
      <input type="checkbox" id="mode-toggle">
      <span class="slider"></span>
    </label>
  </div>

  <div class="chat-container">
    <div class="robot-wrapper">
      <img src="static/-Robot-Waving-unscreen.gif" alt="Robot" class="robot-img" />
    </div>

    <div class="chat-header">
      <img src="https://tinyurl.com/3ssc8mea" alt="Logo" class="logo" />
      <h2>GreenMind AI</h2>
    </div>

    <div id="chat-box" class="chat-box"></div>

    <form id="chat-form" class="chat-form">
      <input type="text" id="user-input" placeholder="Ask something eco-friendly..." required />
      <button type="submit">âž¤</button>
    </form>
  </div>

  <script>
    const form = document.getElementById("chat-form");
    const input = document.getElementById("user-input");
    const chatBox = document.getElementById("chat-box");
    const toggle = document.getElementById("mode-toggle");

    // Dark mode toggle
    toggle.addEventListener("change", () => {
      document.body.classList.toggle("dark-mode");
    });

    // Speech function
    /*function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "en-US";
      speechSynthesis.speak(utterance);
    }*/

    form.onsubmit = async (e) => {
      e.preventDefault();
      const userText = input.value;
      // Fixed: Using backticks for template literals
      chatBox.innerHTML += `<div class='user-msg'>${userText}</div>`;
      input.value = "";

      // Fixed: Using backticks for template literals
      chatBox.innerHTML += `<div class='bot-msg'>Typing...</div>`;
      chatBox.scrollTop = chatBox.scrollHeight;

      try {
        const res = await fetch("/chat", {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded"
          },
          // Fixed: Uncommented the body line to send the message
          body: `message=${encodeURIComponent(userText)}`
        });

        const data = await res.json();
        const botReply = data.reply;

       document.querySelector(".bot-msg:last-child").remove();
        // Fixed: Using backticks for template literals
        chatBox.innerHTML += `<div class='bot-msg'>${botReply}</div>`;
        chatBox.scrollTop = chatBox.scrollHeight;

        /*speak(botReply);*/
      } catch (err) {
        document.querySelector(".bot-msg:last-child").remove();
        // Fixed: Using backticks for template literals
        chatBox.innerHTML += `<div class='bot-msg'>Sorry, something went wrong.</div>`;
        chatBox.scrollTop = chatBox.scrollHeight;
      }
    };
  </script>
</body>
</html>